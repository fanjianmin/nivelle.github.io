---
layout: post
title:  "jvm学习(一)之体系结构"
date:   2017-10-11 00:06:05
categories: jvm
tags: jvm
excerpt: jvm
author: nivelle
---

* content
{:toc}

### jvm体系结构

JVM的全称是java Virtual Machine(java虚拟机),它通过模拟一个计算机来达到一个计算机所具有的计算功能.JVM和实体机一样也必须有一套合适的指令集,这个指令集能够被JVM解析执行.这个指令集我们称为JVM字节码指令集,符合class文件规范的字节码都可以被JVM执行.

![image](http://7xpuj1.com1.z0.glb.clouddn.com/jvm%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84.png)

jvm的结构基本上由4部分组成: 

- 类加载器,在jvm启动时或者在类运行时将需要的class加载到JVM中.每个被jvm装载的类型都有一个对应的java.lang.Class类的实例来表示该类型,该实例可以唯一被jvm装载的class类,要求这个实例和其他类的实例一样都存放在java堆中.

- 执行引擎,执行引擎的任务是负责执行class文件中包含的字节码指令,相当于实际机器上的CPU.执行引擎也就是执行一条条代码的一个流程,而代码都是包含在方法体内的,所有执行引擎本质上就是执行一个个方法所串起来的流程,对应到操作系统中一个执行流程是一java线程,一个java进程可以有多个同时执行的执行流程,每个java线程就是一个执行引擎的实例,那么在一个jvm实例中同时又多个执行引擎工作,这些执行引擎有的在执行用户程序,有的在执行JVM内部的程序.


- 内存区,将内存划分成若干个区以模拟实际机器上的存储,记录和调度功能模块,如实际机器上的各种功能的寄存器或者PC指针的记录器.方法区和java堆是所有线程共享的,也就是可以被所有执行引擎实例访问.每个新的执行引擎实例而被创建时会为这个执行引擎创建一个java栈和pc寄存器,如果当前正在执行一个java方法,那么会在当前的java栈中保存的该线程中方法调用的状态,方法参数,方法局部变量,方法的返回值以及运算的中间结果.而PC寄存器会指向即将执行的下一条指令.


- 本地方法调用,调用C或C++实现的本地方法的代码返回结果

### 执行引擎的架构设计

每当创建一个新的线程时,JVM会为这个线程创建一个java栈,同时会为这个线程分配一个PC寄存器,并且这个PC寄存器会指向这个线程的第一行可执行代码.每当调用一个新方法会在这个栈上创建一个新的栈帧数据结构,这个栈帧会保留这个方法的一些元信息,如在这个方法定义的局部变量,一些用来支持常量池的解析,正常方法返回及异常处理机制等.


JVM在调用某些指令是可能需要使用到常量池中的一些常量,或者是获取常量代表的数据或者这个数据指向的实例化的对象,而这些信息都存储在所有线程共享的方法去和java堆中.

![image](http://7xpuj1.com1.z0.glb.clouddn.com/java%E6%89%A7%E8%A1%8C%E9%83%A8%E4%BB%B6.png)
