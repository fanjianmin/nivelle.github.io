---
layout: post
title:  "redis深入学习(十七)之发布订阅"
date:   2017-09-22 01:06:05
categories: noSQL
tags: redis
excerpt: redis
---

###  频道的订阅与退订

当一个客户端执行SUBSCRIBE命令订阅某个某个频道或某些频道的时候,这个客户端与被订阅频道之间就建立起了一种订阅关系.

redis将所有频道的订阅关系都保存在服务器状态的pubsub_cahnnels字典里面,这个字典的建是某个被订阅的频道,而键的值则是一个链表,链表里面记录了所有订阅这个频道的客户端:

```
struct redisServer{
    //...
    
    //保存所有频道的订阅关系
    dict *pubsub_cahannels;
    //...
}

```

### redis发布订阅

redis提供了发布订阅功能,可用于消息的传输,Redis的发布订阅机制包括三个部分,发布者 ,订阅者和Channel.

![image](http://7xpuj1.com1.z0.glb.clouddn.com/%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85.png)

发布者和订阅者都是Redsi客户端,Channel则为Redis服务器端,发布者将消息发送到某个频道,订阅了这个频道的订阅者就能接收到这条消息.Redis的这种发布订阅机制与基于主题的发布订阅类似,Channel相当于主题.

#### Redis发布订阅功能

- 发布消息

redis采用PUBLISH命令发送消息,其返回值为接收到该消息的订阅者数量

![image](http://img.blog.csdn.net/20170415154014186?/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvd3EyNTI2/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)
