---
layout: post
title:  "微信服务号开发之微信网页授权"
date:   2016-08-07 00:06:05
categories: wechat
tags: wechat
excerpt: wechat
author: nivelle
---

### 微信网页授权

如果用户再微信客户端中访问第三方网页,公众号可以通过微信网页授权机制,来获取用户基本信息,进而实现业务逻辑

#### 网页授权回调域名

- 在微信公众号请求用户网页授权之前,开发者需要先到公众平台公众号设置,去修改回调域名.这里填写的是域名,不要加http://
- 授权回调域名配置规范为全域名,配置之后,此域名吓得页面都可进行OAuth2.0鉴权
- 如果公众号交给第三方进行管理,则不必做任何设置,第三方代替公众号实现网页授权即可

#### 网页授权两种scope的说明

- 以snaspi_base为scope发起的网页授权,是用来获取进入页面用户的openId的,并且是静默授权并自动跳转到回调页的.用户感知就是直接进入了回调页面(业务页)
- 以snaspi_userinfo为scope发起的网页授权,是用来获取用户基本信息的.但这种授权需要用户手动同意,并且由于用户同意过所以无需关注,就可以在授权后获取该用户的基本信息.
- 用户管理类接口中的"获取用户基本信息接口",是在用户和公众号产生消息交互或关注事件推送后,才能根据OpenID来获取用户基本信息.

#### 关于网页授权access_token和普通access_token的区别

- 微信网页授权是通过OAuth2.0机制实现的,在用户授权给公众号后,公众号可以获取到一个网页授权特有的接口调用凭证(网页授权access_token),通过网页授权access_token可以进行授权后接口调用,获取用户基本信息
- 其他维修接口,需要通过基础支持中的"获取access_token"接口来获取到普通access_token调用

#### 关于UnionID

1. 网页授权获取用户基本信息也遵循UnionID机制。即如果开发者有在多个公众号，或在公众号、移动应用之间统一用户帐号的需求，需要前往微信开放平台（open.weixin.qq.com）绑定公众号后，才可利用UnionID机制来满足上述需求。
2. UnionID机制的作用说明：如果开发者拥有多个移动应用、网站应用和公众帐号，可通过获取用户基本信息中的unionid来区分用户的唯一性，因为同一用户，对同一个微信开放平台下的不同应用（移动应用、网站应用和公众帐号），unionid是相同的。

#### 关于特殊场景吓得静默授权

1. 以snsapi_base为scope的网页授权,就静默授权的,用户无感知
2. 对于已经关注公众号的用户,如果用户从公众号的回话或自定义菜单进入本公众号的网页授权页,即使是scope为snsapi_userinfo,也就是静默授权,用户无感知.

#### 授权过程

- 用户同意授权,获取code
- 通过code换取网页授权access_token
- 刷新access_token
- 拉取用户信息(需scope为snsapi_userinfo)
- 检验授权凭证是否有效
