---
layout: post
title:  "spring之容器启动"
date:   2017-05-13 00:06:05
categories: 技术
tags: spring
excerpt: spring容器启动
---


* content
{:toc}

###  容器启动流程



![image](http://7xpuj1.com1.z0.glb.clouddn.com/QQ%E6%88%AA%E5%9B%BE20170513112138.png)

- 启动阶段

  加载ConfigurationMetadata(/xml),然后根据这些信息绑定整个系统对象，工具类（beanDefinitionReader）解析和分析，然后编组为相应的BeanDefinition,最后报保存了bean定义必要信息的BeanDefinition,注册到相应的DeanDefinitionRegister。


- bean实例化阶段

  当某个请求通过容器的getBean方法获取某个对象，就会根据BeanDefinition所提供的信息实例化被请求对象，并为其依赖注入。
  

第一阶段是根据图纸装配生产线，第二阶段就是使用装配好的生产线来生产具体产品。




###  BeanFactoryPostProcessor

该功能允许我们在容器实例化之前，对注册到容器的BeanDefinition所保存的信息做相应修改。

- 手动装配BeanFactory使用BeanFactoryPostProcessor
  
 ```
  //申明将被后处理的BeanFactory
  
  ConfigurableListableBeanFactory beanFactory = new XmlBeanFactory(new ClassPathResource("..."));
  
  //申明要使用的BeanFactoryPostProcessor
  
  PropertyPlaceholderConfigurer propertyPostProcessor = new PropertyPlaceholderConfigurer();
  
  propertyPostProcessor.setLocation(new ClassPathResource("..."));
  
  //执行后处理操作
  
  propertyPostProcessor.postProcessBeanFactory(beanFactory);
  
 ```
  
- ApplicationContext 使用BeanFactoryPostProcessor

```
  <beans>
     /<bean class="org.springframework.bean.factory.config.PropertyPlaceholderConfigurer">
       /<property name ="locations">
          /<list>
            <value>conf/jdbc.properties</value>
            <value>conf/mail.properties</value>
          </list>
       
       </property>
    /</bean>
  </beans>
  
```


