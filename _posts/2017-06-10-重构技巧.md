---
layout: post
title:  "重构技巧"
date:   2017-06-10 00:06:05
categories: 技术
tags: 重构
excerpt: 重构学习
author: nivelle
---

* content
{:toc}

###  提炼函数

一个过长的函数或者一段需要注释才能让人理解用途的代码，则将这段代码放进一个独立函数中。

**优点**：

- 如果函数粒度很小，那么函数被复用的机会就更大
- 使高层函数读起来就像一系列注释
- 如果函数都是细粒度，那么函数的覆写也会更容易些

**做法**
1. 创造一个新函数，根据这个函数的意图来对它命名（以他“做什么”来命名，而不是以他“怎样做”命名）


***即使你想要提炼的代码非常简单，例如只是一条消息或者一个函数调用，只要新函数的名称能够以更好的方式昭示代码意图，你也应该提炼它。
但如果你想不出一个更有意义的名称，就别动***


2. 将提炼出的代码从原函数复制到新建目标函数中

3. 检查源代码，看看是否其中引用了“作用于限于原函数”的变量（局部变量和源函数参数）。
4. 检查是否有“仅用于被提炼代码段”的临时变量，如果有，在目标函数中将他们声明为临时变量。
5. 检查被提炼代码段，查看是否有任何局部变量的值被它改变。如果一个临时变量的值被修改了，看看是否可以将被提炼代码段处理为一个查询，并将结果赋值给相关变量。
6. 将被提炼代码中需要读取的局部变量，当做参数传递给目标函数。
7. 在源函数中，将被提炼代码段替换为对目标函数的调用。

```
如果你将任何临时变量移到目标函数中，请检查他们原本的声明式是否在被提炼代码段的外围。

如果是，现在你可以删除这些声明式。

```

###  以查询取代临时变量
