---
layout: post
title:  "redis深入学习(七)之对象"
date:   2017-09-09 01:06:05
categories: noSQL
tags: redis
excerpt: redis
---

### 前言:
redis没有直接使用基本数据结构来实现键值对数据库,而是基于这些数据结构创建了一个对象系统,这个系统包括字符串对象,列表对象,哈希对象,集合对象和有序集合对象.

redis对象系统实现了基于引用计数计数的内存回收机制,当程序不再使用某个对象的时候,这个对象占用的内存就会自动释放;另外,redis还通过引用计数技术实现了对象共享机制,这一机制可以在适当条件下,通过让多个数据库键共享同一个对象来节约内存.

redis带有访问时间记录信息,该信息可以用于计算数据库键的空转时长,在服务器启动了maxmemory功能情况下,空转时长较大的那些键会优先被服务器删除.

### 对象的类型与编码

redis使用对象来表示数据库中的键和值,每次当我们再redis数据库中创建一个键值对时,我们至少会创建两个对象,一个对象用作键值对的建,另一个用作键值对的值

redis中的每个对象都由一个redisObject结构表示,该结构中和保存数据有关的三个属性分别是type属性,encoding属性和ptr属性:

```
typedef struct redisObject{
    //类型
    unsigned type:4;
    //编码
    unsigned encoding:4;
    //指向底层实现数据结构的指针
    void * ptr;
    //...
}robj;


```

### 类型

对象的type属性记录了对象的类型,这个属性的值可以是以下常量中的一个:

类型常量 | 对象的名称
--- | ---
REDIS_STRING | 字符串对象
REDIS_LIST | 列表对象
REDIS_HASH | 哈希对象
REDIS_SET | 集合对象
REDIS_ZSET | 有序集合对象

### 编码和底层实现

对象的ptr指针指向对象的底层实现数据结构,而这些数据结构有对象的eccoding属性决定.

![image](http://7xpuj1.com1.z0.glb.clouddn.com/%E5%AF%B9%E8%B1%A1%E7%9A%84%E7%BC%96%E7%A0%81.png)




![image](http://7xpuj1.com1.z0.glb.clouddn.com/%E5%AF%B9%E8%B1%A1%E7%B1%BB%E5%9E%8B%E4%B8%AD%E7%9A%84.png)

