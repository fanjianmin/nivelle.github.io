---
layout: post
title:  "多线程学习(三)"
date:   2017-06-03 00:06:05
categories: 技术
tags: 多线程
excerpt: 多线程深入学习
author: nivelle
---

* content
{:toc}

### 任务执行 

**任务是一组逻辑工作单元，而线程则是使任务异步执行的机制**

#####  Executor框架：

线程池简化了线程的管理工作，并且java.util.concurrent提供了一种灵活的线程池实现作为Executor框架的一部分。在java类库中，任务执行的主要抽象不熟Thread，而是Executor。Executor接口如下：
```
public interface executor{
    void execute(Runnable command);
}
```
它提供了一种标准的方法将任务的提交过程与执行过程解耦开来，并用Runnable来表示任务。此外它还提供了对生命周期的支持，以及统计信息收集、应用程序管理机制和性能监视等机制。

Executor基于生产者——消费者模式，提交任务的操作相当于生产者，执行任务的线程则相当于消费者。

示例：基于Executor的Web服务器
```
public class TaskExecutionWebServer {
    
  private static final int NTHREADS =100;
  private static final Executor exec = Executors.newFixedThreadPool(NTHREADS);
  
  public static void main(String args[]) throws IOException{
    ServerSocket socket = new ServerSocket(80);
    while(true){
      final Socket connection = socket.accept();
      Runnable task = new  Runnable() {
        public void run() {
          handleRequest(connection);
        }
      };
      exec.execute(task);
    }
  }
}

```
##### 线程池

定义：指的是管理一组同构工作线程的资源池。线程池是与工作队列密切相关的，其中在工作队列中保存了所有等待执行的任务。工作者线程的任务很简单：从工作队列中获取一个任务，执行任务，然后返回线程池并等待下一个任务。

类库中提供了一个灵活的线程池以及一些有用的默认配置。可以通过调用Executors中的静态工厂方法之一来创建一个线程池：

- newFixedThreadPool。创建一个固定长度的线程池，每当提交一个任务时就创建一个线程，直到达到线程池的最大数量，这时线程池的规模将不再变化。

- newCachedThreadPool。创建一个可缓存的线程池，如果线程池的当前规模超过了处理需求时，那么将回收空闲的线程，而当需求增加时，则可以添加新的线程，线程池的规模不存在任何限制。

- newSingleThreadExecutor。是一个单线程的Executor，它创建单个工作者线程来执行任务，如果这个线程异常结束，会创建另个一线程来代替。它能确保依照任务在队列中的顺序串行执行。

- newScheduledThreadPool。创建一个固定长度的线程池，而且可以延迟或定时的方式来执行任务，类似于Timer.


##### Executor的生命周期

Executor的实现通常会创建线程来执行任务。但JVM只有在所有线程全部终止后才会退出。因此，如果无法正确地关闭Executor，那么JVM将无法结束。
